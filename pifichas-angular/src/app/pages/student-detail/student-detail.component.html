<div id="informe" class="detail-page" *ngIf="student; else loadingTemplate">
  <div class="detail-header">
    <div class="header-left">
      <div class="avatar">
        {{ getStudentInitials() }}
      </div>
      <div class="header-info">
        <h2>{{ student.nombre }} {{ student.apellidos }}</h2>
        <p class="group">{{ student.curso_nombre ? 'Curso: ' + student.curso_nombre : 'Sin Curso' }}</p>
        <p class="student-id">ID Alumno: {{ student.id }}</p>
      </div>
    </div>

    <div class="header-actions">
      <button class="btn-pdf" (click)="generarPDF()">ðŸ“„ Generar Informe PDF</button>
      <button class="btn-report" (click)="saveChanges()">Guardar Todo</button>
      <button class="btn-back-header" (click)="goBack()">Volver</button>
    </div>
  </div>

  <div class="tabs-container">
    <div class="tabs-header">
      <button class="tab-button" [class.active]="activeTab === 'datos'" (click)="selectTab('datos')">
        Datos BÃ¡sicos
      </button>
      <button class="tab-button" [class.active]="activeTab === 'ficha'" (click)="selectTab('ficha')">
        Ficha MÃ©dica
      </button>
      <button class="tab-button" [class.active]="activeTab === 'observaciones'" (click)="selectTab('observaciones')">
        Observaciones
      </button>
    </div>

    <div class="tabs-content">
      <div *ngIf="activeTab === 'datos'" class="tab-pane">
        <h2>Datos BÃ¡sicos</h2>
        <div class="form-section">
          <div class="form-row">
            <label>DNI</label>
            <input type="text" [(ngModel)]="dni" />
          </div>
          <div class="form-row">
            <label>Fecha de Nacimiento</label>
            <input type="date" [(ngModel)]="fechaNacimiento" />
          </div>
          <div class="form-row">
            <label>Contacto Tutor</label>
            <input type="text" [(ngModel)]="contactoTutor" />
          </div>
        </div>
        <button class="btn-save" (click)="saveChanges()">Guardar Datos</button>
      </div>

      <div *ngIf="activeTab === 'ficha'" class="tab-pane">
        <h2>Ficha MÃ©dica y Curricular</h2>
        <div class="form-section">
          <div class="form-group">
            <label>Datos MÃ©dicos</label>
            <textarea [(ngModel)]="datosMedicos" rows="5" placeholder="Alergias, patologÃ­as..."></textarea>
          </div>
          <div class="form-group">
            <label>Adaptaciones Curriculares</label>
            <textarea [(ngModel)]="adaptacionesCurriculares" rows="5" placeholder="Detalles de apoyo..."></textarea>
          </div>
        </div>
        <button class="btn-save" (click)="saveChanges()">Actualizar Ficha</button>
      </div>

      <div *ngIf="activeTab === 'observaciones'" class="tab-pane observations-tab">
        <div class="observations-left">
          <h3>AÃ±adir ObservaciÃ³n</h3>
          <textarea [(ngModel)]="nuevaObservacion" rows="4" placeholder="Escribe aquÃ­..."></textarea>
          <div class="obs-controls">
            <select [(ngModel)]="tipoObservacion">
              <option value="General">General</option>
              <option value="Conducta">Conducta</option>
              <option value="AcadÃ©mico">AcadÃ©mico</option>
              <option value="Social">Social</option>
            </select>
            <button class="btn-add" (click)="addObservation()">AÃ±adir</button>
          </div>
        </div>

        <div class="observations-right">
          <h3>Historial</h3>
          <div class="table-scroll">
            <table>
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Tipo</th>
                  <th>Contenido</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let obs of observaciones">
                  <td>{{ obs.fecha | date:'dd/MM/yy' }}</td>
                  <td><span class="badge">{{ obs.tipo }}</span></td>
                  <td>{{ obs.contenido }}</td>
                  <td>
                    <button class="btn-delete" (click)="confirmDeleteObservation(obs.id)">Borrar</button>
                  </td>
                </tr>
                <tr *ngIf="observaciones.length === 0">
                  <td colspan="4">No hay observaciones registradas.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #loadingTemplate>
  <div class="loader-container">
    <div class="spinner"></div>
    <p>Cargando informaciÃ³n del alumno...</p>
    <div class="loader-actions">
      <button class="btn-back" (click)="goBack()">Volver al Listado</button>
    </div>
  </div>
</ng-template>